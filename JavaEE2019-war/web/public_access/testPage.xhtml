<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition
    template="/WEB-INF/templates/page-template.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:b="http://bootsfaces.net/ui"
    xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
    xmlns:pr="http://primefaces.org/ui"
    >
    <link rel="stylesheet" type="text/css" href="${pageContext.request.contextPath}/styles/resetBSToPF.css" />

    <ui:param name="pagetitle" value="${msg.homePageTitle}"/>
    <ui:define name="content">
        <h:form id="pollForm">
            <pr:panelGrid columns="3" layout="grid" columnClasses="ui-grid-col-3, ui-grid-col-6, ui-grid-col-3">

                <pr:outputLabel value="Title" class="pf"/>

                <pr:inputText  id="titleInput" placeholder="Type Title here..." value="#{createPollBean.title}"  required="true" class="pf" validator="#{titleValidator.validate}" requiredMessage="This field cant be empty" style="width: 100%">
                    <f:ajax event="blur" render="titleInputMessage" /> 
                </pr:inputText>
                
                <pr:message id="titleInputMessage" for="titleInput" />

                <pr:outputLabel value="Description"/>

                <pr:inputText  id="discInput" placeholder="Type description here..." value="#{createPollBean.description}" required="true" requiredMessage="This field cant be empty" style="width: 100%">
                    <f:ajax event="blur" render="discInputMessage" /> 
                </pr:inputText>
            
                <pr:message id="discInputMessage" for="discInput" />

                <pr:outputLabel value="Start Date"/>

                <b:dateTimePicker   id="startDateInput" placeholder="Select start date" value="#{createPollBean.startDate}" mode="popup-icon" required="true" requiredMessage="This field cant be empty">
                    <f:ajax event="blur" render="startDateMessage" /> 
                </b:dateTimePicker>
                
                <pr:message id="startDateMessage" for="startDateInput" />

                <pr:outputLabel value="End Date"/>

                <b:dateTimePicker id="endDateInput"  placeholder="Select end date" value="#{createPollBean.endDate}" mode="popup-icon" required="true" requiredMessage="This field cant be empty">
                    <f:ajax event="blur" render="endDateMessage" /> 
                </b:dateTimePicker>
                
                <pr:message id="endDateMessage" for="endDateInput" />

                <pr:outputLabel value="Poll Type"/>

                <pr:selectOneMenu id="pollTypes" value="#{createPollBean.polltype}"  required="true" class="pf">
                    <f:selectItems value="${pollBean.polltypes}" var="poll" itemValue="#{poll}"  itemLabel="#{poll}" />
                    <f:ajax render=":pollForm:pollItems"/>
                </pr:selectOneMenu>
                
                <pr:message id="pollTypesMessage" for="pollTypes" />

                <pr:outputLabel value="Participants"/>

                <pr:panelGrid columns="1" layout="grid" style="width: 100%">
                    <pr:dataTable id="personTable" value="#{createPollBean.participants}"  var="person">
                        <pr:column headerText="Email">
                            <h:outputText value="#{person.name}"/>
                        </pr:column>
                    </pr:dataTable>
                    <pr:commandButton value="Edit List" type="button" onclick="PF('amodal').show();" />
                </pr:panelGrid>
                
                <pr:message id="personTableMessage" for="personTable" />

                <pr:outputLabel value="Organizers" />

                <pr:panelGrid columns="1" layout="grid" style="width: 100%">
                    <pr:dataTable id="organizersTable" value="#{createPollBean.organizers}" var="person">
                        <pr:column headerText="Email">
                            <h:outputText value="#{person.name}"/>
                        </pr:column>
                    </pr:dataTable>
                    <pr:commandButton value="Edit List" type="button" onclick="PF('orgModal').show();" />
                </pr:panelGrid> 

                
                <pr:message id="organizersTableMessage" for="organizersTable" />

                                
                <pr:outputLabel value="Items"/>

                <pr:panelGrid  columns="1" layout="grid" id="pollItems">
                    <pr:selectCheckboxMenu  value="#{createPollBean.items}" multiple="true"
                                            filter="true" filterMatchMode="startsWith" panelStyle="width:250px" converter="entityConverter" required="true" class="pf" disabled="#{createPollBean.yesNo}" requiredMessage="This field cant be empty" >
                        <f:selectItems value="#{pollBean.nonPermanentPollItems}" var="poll" itemValue="#{poll}"  itemLabel="#{poll.item}" />
                        <f:ajax event="change" render="pollItemsMessage" />
                    </pr:selectCheckboxMenu> 
                    <pr:commandButton  value="Item" type="button" onclick="PF('addItemModal').show();" icon="pi pi-plus" disabled="#{createPollBean.yesNo}"/>
                </pr:panelGrid>
                
                <pr:message id="pollItemsMessage" for="pollItems" />
                
            </pr:panelGrid>
            
              

            <pr:commandButton id="createPollButton"
                             icon="pi pi-check"
                             value="Create Poll"
                             action="#{createPollBean.createPoll}"
                             ajax="false"/>

        </h:form>


        <pr:dialog id="amodal" modal="true" header="Modal Dialog" widgetVar="amodal">
            <h:form>
                <pr:pickList id="PojoPickList" value="#{pickParticipantBean.peronsDualList}" var="person" 
                             itemValue="#{person}" itemLabel="#{person.name}" showSourceControls="true" showTargetControls="true" 
                             showSourceFilter="true" showTargetFilter="true" filterMatchMode="contains" responsive="true" converter="entityConverter" />
                <pr:button value="Cancel"  onclick="PF('amodal').hide();" />
                <pr:commandButton value="Ok" actionListener="#{createPollBean.setParticipants(pickParticipantBean.peronsDualList.target)}" oncomplete="PF('amodal').hide();"  update=":pollForm:personTable" />
            </h:form>
        </pr:dialog>

        <pr:dialog id="orgModal" modal="true" header="Modal Dialog" widgetVar="orgModal">
            <h:form>
                <pr:pickList id="orgPickList" value="#{pickOrganizerBean.peronsDualList}" var="person" 
                             itemValue="#{person}" itemLabel="#{person.name}" showSourceControls="true" showTargetControls="true" 
                             showSourceFilter="true" showTargetFilter="true" filterMatchMode="contains" responsive="true" converter="entityConverter" />
                <pr:button value="Cancel" onclick="PF('orgModal').hide();" />
                <pr:commandButton value="Ok" actionListener="#{createPollBean.setOrganizers(pickOrganizerBean.peronsDualList.target)}" oncomplete="PF('orgModal').hide();"  update=":pollForm:organizersTable" />
            </h:form>
        </pr:dialog>


        <pr:dialog id="addItemModal" modal="true" header="Modal Dialog" widgetVar="addItemModal">
            <h:form>
                <pr:inputText placeholder="Type description here..." value="#{itemBean.item}"/>
                <pr:button value="Cancel" onclick="PF('addItemModal').hide();"/>
                <pr:commandButton value="Ok"  actionListener="#{itemBean.createItem}" oncomplete="$('#addItemModal').modal('hide')" update=":pollForm:pollItems"/>
            </h:form>
        </pr:dialog>

    </ui:define>
</ui:composition>